<div class="categorias-container">
  <p-toast></p-toast>
  
  <div class="header-section">
    <h2>Gestión de Categorías</h2>
    <button 
      pButton 
      label="Nueva Categoría" 
      icon="pi pi-plus" 
      class="p-button-success"
      (click)="mostrarDialogo()"
    ></button>
  </div>

  <!-- Tabla de Categorías -->
  <p-table 
    [value]="categorias" 
    [loading]="cargando"
    [paginator]="true"
    [rows]="10"
    [showCurrentPageReport]="true"
    currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} categorías"
    [rowsPerPageOptions]="[5,10,20]"
    styleClass="p-datatable-gridlines"
  >
    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="id">ID <p-sortIcon field="id"></p-sortIcon></th>
        <th pSortableColumn="nombre">Nombre <p-sortIcon field="nombre"></p-sortIcon></th>
        <th style="width: 12rem">Acciones</th>
      </tr>
    </ng-template>
    
    <ng-template pTemplate="body" let-categoria>
      <tr>
        <td>{{ categoria.id }}</td>
        <td>{{ categoria.nombre }}</td>
        <td>
          <div class="action-buttons">
            <button 
              pButton 
              icon="pi pi-pencil" 
              class="p-button-rounded p-button-warning p-button-sm"
              pTooltip="Editar"
              tooltipPosition="top"
              (click)="editarCategoria(categoria)"
            ></button>
            <button 
              pButton 
              icon="pi pi-trash" 
              class="p-button-rounded p-button-danger p-button-sm"
              pTooltip="Eliminar"
              tooltipPosition="top"
              (click)="confirmarEliminar(categoria)"
            ></button>
          </div>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="3" class="text-center">No hay categorías registradas</td>
      </tr>
    </ng-template>
  </p-table>

  <!-- Diálogo para Crear/Editar Categoría -->
  <p-dialog 
    [(visible)]="mostrarFormulario" 
    [header]="editando ? 'Editar Categoría' : 'Nueva Categoría'"
    [modal]="true"
    [style]="{width: '450px'}"
    [draggable]="false"
    [resizable]="false"
  >
    <form [formGroup]="form" (ngSubmit)="guardarCategoria()">
      <div class="field">
        <label for="nombre" class="label">Nombre de la categoría</label>
        <input 
          id="nombre" 
          type="text" 
          pInputText 
          formControlName="nombre"
          placeholder="Ej. Electrónica"
          class="w-full"
          [ngClass]="{ 'ng-invalid': form.get('nombre')?.invalid && form.get('nombre')?.touched }"
        />
        <small 
          *ngIf="form.get('nombre')?.invalid && form.get('nombre')?.touched" 
          class="p-error"
        >
          El nombre es obligatorio y debe tener al menos 3 caracteres.
        </small>
      </div>

      <div class="dialog-footer">
        <button 
          pButton 
          type="button" 
          label="Cancelar" 
          icon="pi pi-times"
          class="p-button-text"
          (click)="cancelar()"
        ></button>
        <button 
          pButton 
          type="submit" 
          [label]="editando ? 'Actualizar' : 'Guardar'" 
          icon="pi pi-check"
          [loading]="guardando"
          [disabled]="form.invalid || guardando"
        ></button>
      </div>
    </form>
  </p-dialog>

  <!-- Diálogo de Confirmación de Eliminación -->
  <p-confirmDialog></p-confirmDialog>
</div>

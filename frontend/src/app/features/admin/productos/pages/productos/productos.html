<div class="productos-container">
  <h2 class="text-center mb-4">Gestión de Productos</h2>

  <!-- Botón para mostrar/ocultar formulario -->
  <div class="d-flex justify-content-end mb-3">
    <button pButton label="Nuevo Producto" icon="pi pi-plus" class="p-button-success" (click)="mostrarFormulario = !mostrarFormulario"></button>
  </div>

  <!-- Formulario -->
  <div *ngIf="mostrarFormulario" class="p-card p-4 mb-4 shadow-2" style="border-radius: 12px; background: #f9f9f9;">
    <h4 class="mb-4">{{ editando ? 'Editar Producto' : 'Registrar Producto' }}</h4>
    <form #formProducto="ngForm" (ngSubmit)="guardar()" novalidate class="p-fluid">
      <div class="grid p-fluid gap-3">
        
        <div class="col-12 field">
          <label for="nombre" class="mb-2">Nombre</label>
          <input id="nombre" type="text" pInputText [(ngModel)]="producto.nombre" name="nombre" required placeholder="Ejemplo: Zapatillas deportivas" />
        </div>

        <div class="col-12 field">
          <label for="descripcion" class="mb-2">Descripción</label>
          <textarea id="descripcion" pInputTextarea [(ngModel)]="producto.descripcion" name="descripcion" rows="3" autoResize="true" required placeholder="Calzado cómodo ideal para entrenar"></textarea>
        </div>

        <div class="col-6 field">
          <label for="precio" class="mb-2">Precio (S/)</label>
          <input id="precio" type="number" pInputText [(ngModel)]="producto.precio" name="precio" required min="1" placeholder="0.00" />
        </div>

        <div class="col-6 field">
          <label for="stock" class="mb-2">Stock</label>
          <input id="stock" type="number" pInputText [(ngModel)]="producto.stock" name="stock" required placeholder="Cantidad disponible" />
        </div>

        <div class="col-6 field">
          <label for="disponibilidad" class="mb-2">Disponibilidad</label>
          <select id="disponibilidad" [(ngModel)]="producto.disponibilidad" name="disponibilidad" class="p-inputtext" required>
            <option value="" disabled>Seleccione</option>
            <option value="Disponible">Disponible</option>
            <option value="Agotado">Agotado</option>
          </select>
        </div>

        <div class="col-6 field">
          <label for="categoriaId" class="mb-2">Categoría</label>
          <select id="categoriaId" [(ngModel)]="producto.categoriaId" name="categoriaId" class="p-inputtext" required>
            <option value="" disabled>Seleccione una categoría</option>
            <option *ngFor="let categoria of categorias" [value]="categoria.id">{{ categoria.nombre }}</option>
          </select>
        </div>

        <div class="col-12 field">
          <label for="imagenNombre" class="mb-2">Nombre de la Imagen</label>
          <input id="imagenNombre" type="text" pInputText [(ngModel)]="producto.imagenNombre" name="imagenNombre" placeholder="Ejemplo: zapatillas1.jpg" />
        </div>
      </div>

     
      <div class="flex justify-content-center gap-3 mt-4">
        <button pButton type="submit" [label]="editando ? 'Actualizar' : 'Guardar'" icon="pi pi-save" class="p-button-rounded p-button-success"></button>
        <button pButton type="button" label="Cancelar" icon="pi pi-times" class="p-button-rounded p-button-secondary" (click)="cancelar(); mostrarFormulario = false"></button>
      </div>
    </form>
  </div>

  
  <p-table *ngIf="!mostrarFormulario" [value]="productos" [paginator]="true" [rows]="6" [tableStyle]="{ 'min-width': '65rem' }" responsiveLayout="scroll">
    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="id">ID <p-sortIcon field="id" /></th>
        <th pSortableColumn="nombre">Nombre <p-sortIcon field="nombre" /></th>
        <th pSortableColumn="categoria">Categoría <p-sortIcon field="categoria" /></th>
        <th pSortableColumn="precio">Precio (S/)<p-sortIcon field="precio" /></th>
        <th pSortableColumn="stock">Stock <p-sortIcon field="stock" /></th>
        <th>Disponibilidad</th>
        <th>Imagen</th>
        <th>Acciones</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-p>
      <tr>
        <td>{{ p.id }}</td>
        <td>{{ p.nombre }}</td>
        <td>{{ p.categoria }}</td>
        <td>S/ {{ p.precio | number: '1.2-2' }}</td>
        <td>{{ p.stock }}</td>
        <td>
          <span class="badge" [ngClass]="{ 'bg-success': p.disponibilidad === 'Disponible', 'bg-danger': p.disponibilidad === 'Agotado' }">
            {{ p.disponibilidad }}
          </span>
        </td>
        <td>{{ p.imagenNombre || '-' }}</td>
        <td>
          <button pButton icon="pi pi-pencil" class="p-button-rounded p-button-warning p-button-sm me-2" (click)="editar(p)"></button>
          <button pButton icon="pi pi-trash" class="p-button-rounded p-button-danger p-button-sm" (click)="eliminar(p.id!)"></button>
        </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="8" class="text-center text-muted">No hay productos registrados.</td>
      </tr>
    </ng-template>
  </p-table>
</div>
